' Gambas class file

Property Read Panel As Panel

Private $hLeftPanel As Panel
Private $hRightPanel As Panel
Private $hPanel As Panel
Private $hGrid As CScoreGrid
Private $hButton As Button
Private $hGameDef As CGameDef

Public Sub _new(hContainer As Container)

  $hPanel = New Panel(hContainer) As "Panel"

  With $hPanel
    .Arrangement = Arrange.Horizontal
    .Expand = True
  End With

End

Private Function Panel_Read() As Panel

  Return $hPanel

End

Public Sub NewGame()

  $hGameDef = MGameLoader.GameDefs[MSettings.GameId]

  GridInit()
  Settings()
  CalcGridWidth()

End

Public Sub Settings()

  If MSettings.ShowMaxCol Then
    $hGrid.Columns[1].Width = 48
  Else
    $hGrid.Columns[1].Width = 0
  Endif

  If MSettings.ShowTopCol Then
    $hGrid.Columns[2].Width = 48
  Else
    $hGrid.Columns[2].Width = 0
  Endif

  'UpdateHeaderText()

End

Private Sub CalcGridWidth()

  Dim iWidth As Integer

  iWidth = $hGrid.Columns[0].Width + $hGrid.Columns[1].Width + $hGrid.Columns[2].Width + MSettings.Players * 52
  $hGrid.Width = iWidth

End

Private Sub GridInit()

  Dim iMaxCol As Integer = MSettings.Players + 2
  Dim iMaxRow As Integer = $hGameDef.Rows.Count - 1

  Try $hLeftPanel.Delete
  Try $hGrid.Delete
  Try $hRightPanel.Delete

  $hLeftPanel = New Panel($hPanel)
  $hGrid = New CScoreGrid($hPanel, $hGameDef) As "GridView"
  $hRightPanel = New Panel($hPanel)

  $hLeftPanel.Expand = True
  $hRightPanel.Expand = True

End