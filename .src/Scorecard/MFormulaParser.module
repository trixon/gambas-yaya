' Gambas module file

Private $aValues As Integer[]
Private $aArgList As New Integer[]
Private $hGameRow As CGameRow

Public Function ParseFormula(aValues As Integer[], hGameRow As CGameRow) As Integer

  Dim i As Integer
  Dim iResult As Integer = -1
  Dim aParseString As String[]
  Dim sCommand As String

  $aValues = aValues
  $hGameRow = hGameRow
  aParseString = Split(hGameRow.Formula, " ")
  sCommand = aParseString[0]

  $aArgList.Clear
  Print $hGameRow.Text, $hGameRow.Formula;;

  For i = 1 To aParseString.Length - 1
    $aArgList.Add(CInt(aParseString[i]))
    'Print $aArgList[$aArgList.Length - 1]
  Next

  Select String.UCase(sCommand)
    Case "DUPLICATES"
      iResult = CalcDuplicates($aArgList[0])
    Case "HOUSE"
    Case "PAIR"
    Case "STRAIGHT"
    Case "SUM"
      iResult = CalcSum()
    Default
      Debug "Unknown command: " & sCommand
  End Select

  Print iResult

  Return iResult

End

Private Function CalcDuplicates(iNumOfDuplicates As Integer) As Integer

  Dim i As Integer
  Dim iCount As Integer
  Dim iResult As Integer

  For i = 6 DownTo 1
    iCount = MCollections.Frequency($aValues, i)
    If iCount >= iNumOfDuplicates Then
      iResult = iNumOfDuplicates * i
      If $hGameRow.Max = $hGameRow.Lim Then
        iResult = $hGameRow.Max
      Endif
      Break
    Endif
  Next

  Return iResult

End

Private Function CalcSum() As Integer

  If $aArgList.Length = 0 Then
    Return CalcSumTotal()
  Else
    Return CalcSumOf($aArgList[0])
  Endif

End

Private Function CalcSumTotal() As Integer

  Dim iResult As Integer
  Dim iItem As Integer

  For Each iItem In $aValues
    iResult += iItem
  Next

  Return iResult

End

Private Function CalcSumOf(iFace As Integer) As Integer

  Return iFace * MCollections.Frequency($aValues, iFace)

End
