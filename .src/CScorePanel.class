' Gambas class file

Property Read Panel As Panel

Private $hPanel As Panel
Private $hGridView As GridView
Private $hButton As Button
Private $hGameDef As CGameDef

Public Sub _new(hContainer As Container)

  $hPanel = New Panel(hContainer) As "Panel"

  With $hPanel
    .Arrangement = Arrange.Horizontal
    .Background = &HFFFFDF
    .Expand = True
  End With

  ' $hGameDef = MGameLoader.GameDefs["default"]
  ' $hGameDef.Debug
  ' $hGridView = New GridView($hPanel) As "GridView"
  ' With $hGridView
  '   .Columns.Count = MSettings.Players + 1
  '   .Rows.Count = $hGameDef.Rows.Count
  '   .Columns.Width = 52
  '   .W = 400
  '   .H = 200
  '   .Border = Border.None
  '   .Background = &HFFFFDF
  ' End With

End

Private Function Panel_Read() As Panel

  Return $hPanel

End

Public Sub GridView_Data(Row As Integer, Column As Integer)

  Dim hGameRow As CGameRow
  Dim hData As _GridView_Data

  '$hGridView = Null
  hGameRow = $hGameDef.Rows[Row]
  hData = $hGridView.Data
  hData.Padding = 4
  Debug Row; "x"; Column
  If Column = 0 Then
    hData.Text = hGameRow.Text
    hData.Background = Color.Orange
  Endif
  If Column = 1 Then
    If Row = 0 Then
      hData.Text = ("Max")
      hData.Alignment = Align.Center
    Else
      hData.Text = hGameRow.Max
      hData.Alignment = Align.Right
      hData.Padding = 4
    Endif
  Endif
  If Column = 2 Then
    If Row = 0 Then
      hData.Text = ("Top")
      hData.Alignment = Align.Center
    Else
      hData.Text = hGameRow.Lim
      hData.Alignment = Align.Right
      hData.Padding = 8
    Endif
  Endif

  If hGameRow.IsSum Or hGameRow.IsCounter Then
    hData.Background = Color.Yellow
    hData.Padding = 2
    hData.Font = Font["Bold"]
  Endif

End

Public Sub NewGame()

  $hGameDef = MGameLoader.GameDefs[MSettings.GameId]
  $hGameDef.Debug
  $hGridView = New GridView($hPanel) As "GridView"

  With $hGridView
    .Columns.Count = MSettings.Players + 3
    .Rows.Count = $hGameDef.Rows.Count
    .Columns.Width = 52
    .W = 400
    .H = 200
    .Border = Border.None
    .Background = &HFFFFDF
  End With
  $hGridView.Columns[0].Width = 128

  Settings()
  CalcGridWidth()

End

Public Sub Settings()

  If MSettings.ShowMaxCol Then
    $hGridView.Columns[1].Width = 48
  Else
    $hGridView.Columns[1].Width = 0
  Endif

End

Private Sub CalcGridWidth()

  Dim iWidth As Integer

  iWidth = $hGridView.Columns[0].Width + $hGridView.Columns[1].Width + $hGridView.Columns[2].Width + MSettings.Players * 52
  $hGridView.Width = iWidth

End
