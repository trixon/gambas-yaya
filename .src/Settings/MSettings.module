' Gambas module file

Property Players As Integer
Property ReverseMouseScroll As Boolean
Property GameId As String
Property {Variant} As Integer
Property ShowHints As Boolean
Property ShowMaxCol As Boolean
Property ShowTopCol As Boolean
Property PlayerNames As String[]
Property PlayerSelection As String[]
Property ShowSymbols As Boolean
Property FullScreen As Boolean
Property {Font} As String

Public Const DEFAULT_CELL_BG As Integer = &HFFFF9F
Public Const DEFAULT_CELL_FG As Integer = &H555555
Public Const DEFAULT_HEADER_BG As Integer = &HFFC71F
Public Const DEFAULT_HEADER_FG As Integer = &H000000
Public Const DEFAULT_INDICATOR_HI_BG As Integer = &H00FF00
Public Const DEFAULT_INDICATOR_HI_FG As Integer = &HFFFFFF
Public Const DEFAULT_INDICATOR_LO_BG As Integer = &HFF0000
Public Const DEFAULT_INDICATOR_LO_FG As Integer = &HFFFFFF
Public Const DEFAULT_MASK As Integer = &HBBBBBB
Public Const DEFAULT_NAME_BG As Integer = &H444444
Public Const DEFAULT_NAME_FG As Integer = &HFFC71F
Public Const DEFAULT_SUM_BG As Integer = &HFFFF00
Public Const DEFAULT_SUM_FG As Integer = &H000000

Public ColorNames As String[] = [("Header column"), ("Header row"), ("Sum"), ("Row"), ("Indicator, high"), ("Indicator, low")]

Public Enum Header, Name, Sum, Cell, IndicatorHi, IndicatorLo, Mask

Private Const KEY_GAME_PLAYERS As String = "Game/Players"
Private Const KEY_REVERSE_MOUSE_SCROLL As String = "ReverseMouseScroll"
Private Const KEY_GAME_ID As String = "Game/Id"
Private Const KEY_GAME_VARIANT As String = "Game/Variant"
Private Const KEY_SCORECARD_FONT As String = "Scorecard/Font"
Private Const KEY_SCORECARD_SHOW_HINTS As String = "Scorecard/ShowHints"
Private Const KEY_SCORECARD_SHOW_MAXCOL As String = "Scorecard/ShowMax"
Private Const KEY_SCORECARD_SHOW_SYMBOLS As String = "Scorecard/ShowSymbols"
Private Const KEY_SCORECARD_SHOW_TOPCOL As String = "Scorecard/ShowTop"
Private Const KEY_PLAYER_NAMES As String = "Players"
Private Const KEY_PLAYER_SELECTION As String = "Game/PlayerSelection"
Private Const KEY_FULL_SCREEN As String = "Window/FullScreen"
Private Const KEY_BACKGROUND As String = "Colors/Background_"
Private Const KEY_FOREGROUND As String = "Colors/Foreground_"

Private $aBackgroundDefaults As Integer[] =
  [DEFAULT_HEADER_BG,
  DEFAULT_NAME_BG,
  DEFAULT_SUM_BG,
  DEFAULT_CELL_BG,
  DEFAULT_INDICATOR_HI_BG,
  DEFAULT_INDICATOR_LO_BG,
  DEFAULT_MASK]
Private $aForegroundDefaults As Integer[] =
  [DEFAULT_HEADER_FG,
  DEFAULT_NAME_FG,
  DEFAULT_SUM_FG,
  DEFAULT_CELL_FG,
  DEFAULT_INDICATOR_HI_FG,
  DEFAULT_INDICATOR_LO_FG,
  DEFAULT_MASK]
Private $aBackground As New Integer[$aBackgroundDefaults.Length]
Private $aForeground As New Integer[$aForegroundDefaults.Length]

Public Function GetBackground(Index As Integer) As Integer

  Return $aBackground[Index]

End

Public Sub SetBackground(Index As Integer, Color As Integer)

  $aBackground[Index] = Color

End

Public Function GetForeground(Index As Integer) As Integer

  Return $aForeground[Index]

End

Public Sub SetForeground(Index As Integer, Color As Integer)

  $aForeground[Index] = Color

End

Public Sub Load()

  Dim i As Integer

  For i = 0 To $aBackground.Max
    $aBackground[i] = Settings[KEY_BACKGROUND & i, $aBackgroundDefaults[i]]
  Next

  For i = 0 To $aForeground.Max
    $aForeground[i] = Settings[KEY_FOREGROUND & i, $aForegroundDefaults[i]]
  Next

End

Public Sub Save()

  Dim i As Integer

  Settings.Reload()

  For i = 0 To $aBackground.Max
    Settings[KEY_BACKGROUND & i] = $aBackground[i]
  Next

  For i = 0 To $aForeground.Max
    Settings[KEY_FOREGROUND & i] = $aForeground[i]
  Next

  Settings.Save()

End

Private Function Players_Read() As Integer

  Return Settings[KEY_GAME_PLAYERS, 2]

End

Private Sub Players_Write(Value As Integer)

  Settings[KEY_GAME_PLAYERS] = Value

End

Private Function ReverseMouseScroll_Read() As Boolean

  Return Settings[KEY_REVERSE_MOUSE_SCROLL, False]

End

Private Sub ReverseMouseScroll_Write(Value As Boolean)

  DicePanel.ReverseMouseScroll = Value
  Settings[KEY_REVERSE_MOUSE_SCROLL] = Value

End

Private Function GameId_Read() As String

  Return Settings[KEY_GAME_ID, "default"]

End

Private Sub GameId_Write(Value As String)

  Settings[KEY_GAME_ID] = Value

End

Private Function ShowHints_Read() As Boolean

  Return Settings[KEY_SCORECARD_SHOW_HINTS, True]

End

Private Sub ShowHints_Write(Value As Boolean)

  Settings[KEY_SCORECARD_SHOW_HINTS] = Value

End

Private Function ShowMaxCol_Read() As Boolean

  Return Settings[KEY_SCORECARD_SHOW_MAXCOL, True]

End

Private Sub ShowMaxCol_Write(Value As Boolean)

  Settings[KEY_SCORECARD_SHOW_MAXCOL] = Value

End

Private Function ShowTopCol_Read() As Boolean

  Return Settings[KEY_SCORECARD_SHOW_TOPCOL, True]

End

Private Sub ShowTopCol_Write(Value As Boolean)

  Settings[KEY_SCORECARD_SHOW_TOPCOL] = Value

End

Private Function PlayerNames_Read() As String[]

  Return LoadStringArray(KEY_PLAYER_NAMES)

End

Private Sub PlayerNames_Write(Value As String[])

  SaveStringArray(KEY_PLAYER_NAMES, Value)

End

Private Function PlayerSelection_Read() As String[]

  Return LoadStringArray(KEY_PLAYER_SELECTION)

End

Private Sub PlayerSelection_Write(Value As String[])

  SaveStringArray(KEY_PLAYER_SELECTION, Value)

End

Private Function LoadStringArray(sKey As String) As String[]

  Dim sNames As String = Settings[sKey]

  If sNames Then
    Return Split(sNames, "|", "", True, False)
  Else
    Return New String[]
  Endif

End

Private Sub SaveStringArray(sKey As String, Value As String[])

  Dim sName As String
  Dim sNames As String

  For Each sName In Value
    sNames = sNames & "|" & sName
  Next

  Settings[sKey] = String.Right(sNames, -1)

End

Private Function Variant_Read() As Integer

  Return Settings[KEY_GAME_VARIANT, 0]

End

Private Sub Variant_Write(Value As Integer)

  Settings[KEY_GAME_VARIANT] = Value

End

Private Function ShowSymbols_Read() As Boolean

  Return Settings[KEY_SCORECARD_SHOW_SYMBOLS, False]

End

Private Sub ShowSymbols_Write(Value As Boolean)

  Settings[KEY_SCORECARD_SHOW_SYMBOLS] = Value

End

Private Function FullScreen_Read() As Boolean

  Return Settings[KEY_FULL_SCREEN, False]

End

Private Sub FullScreen_Write(Value As Boolean)

  Settings[KEY_FULL_SCREEN] = Value

End

Private Function Font_Read() As String

  Return Settings[KEY_SCORECARD_FONT, Application.Font.ToString()]

End

Private Sub Font_Write(Value As String)

  Settings[KEY_SCORECARD_FONT] = Value

End
